import React from 'react';
import thunk from 'redux-thunk';

import { createBrowserHistory } from 'history';
import { render } from 'react-dom';
import { applyMiddleware, combineReducers, createStore } from 'redux';
import { Provider } from 'react-redux';
import { Router, Route } from 'react-router';
import { routerMiddleware, routerReducer, syncHistoryWithStore } from 'react-router-redux';

{{#if pages}}
// pages
{{#each pages}}
import {{{case @key 'pascal'}}}Page from './pages/{{{@key}}}/{{{case @key 'pascal'}}}';
{{/each}}

{{/if}}
{{#if reducers}}
// reducers
{{#each reducers}}
import {{{@key}}}Reducer from './reducers/{{{@key}}}';
{{/each}}

{{/if}}
{{#if templates}}
// templates
{{#each templates}}
import {{{case @key 'pascal'}}}Template from './templates/{{{@key}}}/{{{case @key 'pascal'}}}';
{{/each}}

{{/if}}
import './App.sass';

const history = createBrowserHistory();
const router = routerMiddleware(history);

const store = createStore(
  combineReducers({
    routing: routerReducer,
    {{#each reducers}}
    {{{@key}}}: {{{@key}}}Reducer{{#unless @last}},{{/unless}}
    {{/each}}
  }),
  applyMiddleware(
    thunk,
    router
  )
);

render(
  <Provider store={store}>
    <Router history={history}>
      {{#each routes}}
      <{{{case template 'pascal'}}}Template{{#if paths}}>
        {{#each paths}}
        <Route path="{{#if index}}/{{else}}{{@key}}{{/if}}" component={ {{{case page 'pascal'}}}Page } {{#if index}}exact{{/if}} />
        {{/each}}
      </{{{case template 'pascal'}}}Template>{{else}} />{{/if}}
      {{/each}}
    </Router>
  </Provider>,
  document.getElementById('app')
);
